<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Football World Cup Dashboard</title>
    <style>
        /* Stilizarea paginii */
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 0;
            background-color: #f4f4f4;
            color: #333;
        }

        h1 {
            text-align: center;
            padding: 20px;
            background-color: #4CAF50;
            color: white;
        }

        p {
            text-align: center;
            font-size: 16px;
            margin-bottom: 20px;
        }

        h2 {
            text-align: center;
            margin-bottom: 20px;
        }

        label {
            font-size: 18px;
            margin-right: 10px;
        }

        select {
            padding: 5px;
            font-size: 16px;
        }

        table {
            width: 80%;
            margin: 20px auto;
            border-collapse: collapse;
            background-color: white;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
        }

        th, td {
            padding: 20px;
            text-align: center;
            border-bottom: 1px solid #ddd;
        }

        th {
            background-color: #4CAF50;
            color: white;
        }

        tr:hover {
            background-color: #f1f1f1;
        }

        .empty-message {
            text-align: center;
            padding: 20px;
        }

        #customInput, #playerInput {
            margin-top: 20px;
            text-align: center;
            display: none; /* Hidden by default */
        }

        #customInput input, #playerInput input {
            padding: 10px;
            font-size: 16px;
            width: 200px;
        }

        #customInput button, #playerInput button {
            padding: 10px 15px;
            font-size: 16px;
            background-color: #4CAF50;
            color: white;
            border: none;
            cursor: pointer;
        }

        #customInput button:hover, #playerInput button:hover {
            background-color: #45a049;
        }
    </style>

    <script>
        // Function to fetch data from the server
        function fetchData() {
            const selectedTable = document.getElementById("tableDropdown").value; // Selected table
            const table = document.getElementById("dataTable");

            // Show or hide the custom input divs based on selection
            const customInputDiv = document.getElementById("customInput");
            const playerInputDiv = document.getElementById("playerInput");

            if (selectedTable === "clasamente") {
                customInputDiv.style.display = "block";
                playerInputDiv.style.display = "none";
            } else if (selectedTable === "jucatori") {
                playerInputDiv.style.display = "block";
                customInputDiv.style.display = "none";
            } else {
                customInputDiv.style.display = "none";
                playerInputDiv.style.display = "none";
            }

            if (selectedTable === "") {
                table.innerHTML = ""; // Clear the table content if no table is selected
                return;
            }

            const endpoint = `/admin/api/${selectedTable}`; // Corresponding endpoint

            // Fetch request to the endpoint
            fetch(endpoint)
                .then(response => {
                    if (!response.ok) {
                        throw new Error(`HTTP error! status: ${response.status}`);
                    }
                    return response.json();
                })
                .then(data => {
                    displayTable(data, selectedTable); // Display the fetched data in the table
                })
                .catch(error => {
                    console.error('Error fetching data:', error);
                    alert("A apărut o eroare la preluarea datelor! Verificați conexiunea cu baza de date sau serverul.");
                });
        }

        // Function to fetch minimum rankings data
        function fetchMinData() {
            const table = document.getElementById("dataTable");
            const minPoints = document.getElementById("minInput").value;

            if (!minPoints) {
                alert("Introduceți un punctaj minim valid!");
                return;
            }

            const endpoint = `/admin/api/clasamente/minim?minPoints=${minPoints}`;

            // Fetch request to the endpoint
            fetch(endpoint)
                .then(response => {
                    if (!response.ok) {
                        throw new Error(`HTTP error! status: ${response.status}`);
                    }
                    return response.json();
                })
                .then(data => {
                    displayFilteredTable(data, ["tara", "meciuri_jucate", "puncte", "golaveraj"]); // Display filtered data in the table
                })
                .catch(error => {
                    console.error('Error fetching data:', error);
                    alert("A apărut o eroare la preluarea datelor! Verificați conexiunea cu baza de date sau serverul.");
                });
        }

        // Function to fetch minimum goals data for players
        function fetchMinGoals() {
            const table = document.getElementById("dataTable");
            const minGoals = document.getElementById("goalInput").value;

            if (!minGoals) {
                alert("Introduceți un număr minim de goluri valid!");
                return;
            }

            const endpoint = `/admin/api/jucatori/minim?minGoals=${minGoals}`;

            // Encode user and password for Basic Authentication
            const username = "admin";
            const password = "parola";
            const basicAuth = 'Basic ' + btoa(`${username}:${password}`);

            // Fetch request to the endpoint
            fetch(endpoint)
                .then(response => {
                    if (!response.ok) {
                        throw new Error(`HTTP error! status: ${response.status}`);
                    }
                    return response.json();
                })
                .then(data => {
                    displayFilteredTable(data, ["nume_jucator", "tara", "pozitie_jucata", "goluri"]); // Display filtered data in the table
                })
                .catch(error => {
                    console.error('Error fetching data:', error);
                    alert("A apărut o eroare la preluarea datelor! Verificați conexiunea cu baza de date sau serverul.");
                });
        }

        // Function to populate the table with data
        function displayTable(data, selectedTable) {
            const table = document.getElementById("dataTable");
            table.innerHTML = ''; // Clear previous table data

            if (!data || data.length === 0) {
                table.innerHTML = '<tr><td colspan="5" class="empty-message">No data available</td></tr>';
                return;
            }

            const columnsToDisplay = Object.keys(data[0]);

            // Create table header dynamically based on the selected columns
            const headerRow = document.createElement("tr");

            columnsToDisplay.forEach(header => {
                const th = document.createElement("th");
                th.innerText = header.replace('_', ' '); // Replace underscores for readability
                headerRow.appendChild(th);
            });
            table.appendChild(headerRow);

            // Add table rows
            data.forEach(item => {
                const row = document.createElement("tr");
                columnsToDisplay.forEach(header => {
                    const td = document.createElement("td");
                    td.innerText = item[header] !== null ? item[header] : 'N/A'; // Handle null values
                    row.appendChild(td);
                });
                table.appendChild(row);
            });
        }

        // Function to display filtered table
        function displayFilteredTable(data, columnsToDisplay) {
            const table = document.getElementById("dataTable");
            table.innerHTML = ''; // Clear previous table data

            if (!data || data.length === 0) {
                table.innerHTML = '<tr><td colspan="5" class="empty-message">No data available</td></tr>';
                return;
            }

            // Create table header dynamically based on the selected columns
            const headerRow = document.createElement("tr");

            columnsToDisplay.forEach(header => {
                const th = document.createElement("th");
                th.innerText = header.replace('_', ' '); // Replace underscores for readability
                headerRow.appendChild(th);
            });
            table.appendChild(headerRow);

            // Add table rows
            data.forEach(item => {
                const row = document.createElement("tr");
                columnsToDisplay.forEach(header => {
                    const td = document.createElement("td");
                    td.innerText = item[header] !== null ? item[header] : 'N/A'; // Handle null values
                    row.appendChild(td);
                });
                table.appendChild(row);
            });
        }
    </script>
</head>
<body>
<h1>Bine ati venit pe pagina campionatului mondial de fotbal</h1>
<h2>Explorati lumea fotbalului selectand mai jos informatia dorita</h2>

<div style="text-align: center;">
    <label for="tableDropdown">Selectati ce doriti sa vizualizati azi:</label>
    <select id="tableDropdown" onchange="fetchData()"> <!-- Dropdown for table selection -->
        <option value="" selected>Nicio tabela selectata</option>
        <option value="clasamente">Clasamente</option>
        <option value="echipe">Echipe</option>
        <option value="jucatori">Jucători</option>
        <option value="meciuri">Meciuri</option>
        <option value="sponsori">Sponsori</option>
        <option value="stadioane">Stadioane</option>
    </select>
</div>

<table id="dataTable">
    <!-- The table will be dynamically populated with data -->
</table>

<div id="customInput">
    <label for="minInput">Introduceți punctajul minim:</label>
    <input type="number" id="minInput" placeholder="0">
    <button onclick="fetchMinData()">Executa</button>
</div>

<div id="playerInput">
    <label for="goalInput">Introduceți numărul minim de goluri:</label>
    <input type="number" id="goalInput" placeholder="0">
    <button onclick="fetchMinGoals()">Executa</button>
</div>

</body>
</html>
